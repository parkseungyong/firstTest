<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="enjoy">

  <select id="select_enjoy_list" parameterType="map" resultType="map">
            select a.enjoy_id
                 , a.enjoy_gubn
                 , c.code_name		as enjoy_gubn_name
                 , a.penjoy_id
                 , a.enjoy_level
                 , a.price_yn
                 , a.enjoy_name
                 , b.enjoy_name 	as penjoy_name
                 , a.enjoy_info
                 , a.location
                 , a.take_time
                 , a.transfer
				 , a.enjoy_exclude
                 , a.enjoy_include
                 , a.enjoy_prepare
                 , a.enjoy_detail
                 , a.enjoy_schedule
                 , a.kid_cond
                 , a.use_limit
                 , a.sort_flag
                 , a.use_yn
                 , a.est_yn
                 , a.main_yn
                 , a.company_code
                 , a.enjoy_pic
                 , a.voucher_yn
                 , a.img_path_00
                 , a.img_path_01
                 , a.img_path_02
                 , a.img_path_03
                 , a.img_path_04
                 , a.img_path_05
                 , a.img_path_06
                 , a.init_date
                 , a.init_user
				 , a.up_date
				 , a.up_user
              from enjoy_master a left outer join enjoy_master b on a.penjoy_id = b.enjoy_id
              					  left outer join code_master c on a.enjoy_gubn = c.code and code_gubn = '113'
             where 1=1
          <if test="enjoy_id != null and enjoy_id != ''">
               and a.enjoy_id 		= #{enjoy_id}
          </if>
          <if test="penjoy_id != null and penjoy_id != ''">
               and a.penjoy_id		= #{penjoy_id}
          </if>
          <if test="enjoy_level != null and enjoy_level != ''">          
               and a.enjoy_level	= #{enjoy_level}
          </if>
          <if test="price_yn != null and price_yn != ''">               
               and a.price_yn		= #{price_yn}
          </if>
          <if test="use_yn != null and use_yn != ''">
               and a.use_yn		= #{use_yn}
          </if>
          <if test="enjoy_name != null and enjoy_name != ''">
               and upper(a.enjoy_name)	like upper(concat('%', #{enjoy_name}, '%'))
          </if>
          <if test="est_yn != null and est_yn != ''">               
               and a.est_yn		= #{est_yn}
          </if>
          <if test="enjoy_gubn != null and enjoy_gubn != ''">               
               and a.enjoy_gubn	= #{enjoy_gubn}
          </if>               
             order by a.use_yn desc
			        , ifnull(c.sort_flag,'99'), lpad(a.sort_flag,4,'0')
  </select>

  <select id="select_enjoy_detail" parameterType="map" resultType="map">
            select a.enjoy_id
                 , case a.penjoy_id when '' then a.enjoy_id else a.penjoy_id end	as penjoy_id
                 , a.enjoy_level
                 , a.price_yn
                 , a.enjoy_name
                 , a.enjoy_info
                 , a.location
                 , a.take_time
                 , a.transfer
				 , a.enjoy_exclude
                 , a.enjoy_include
                 , a.enjoy_prepare
                 , a.enjoy_detail
                 , a.enjoy_schedule
                 , a.kid_cond
                 , a.use_limit
                 , a.sort_flag
                 , a.use_yn
                 , a.est_yn
                 , a.main_yn
                 , a.company_code
                 , a.voucher_yn
                 , a.img_path_00
                 , a.img_path_01
                 , a.img_path_02
                 , a.img_path_03
                 , a.img_path_04
                 , a.img_path_05
                 , a.img_path_06
                 , a.init_date
                 , a.init_user
				 , a.up_date
				 , a.up_user
				 , b.price_name
				 , b.adult_cost
				 , b.adult_sales_price
				 , b.adult_b2b_price
				 , b.kid_cost
				 , b.kid_sales_price
				 , b.kid_b2b_price
              from enjoy_master a left outer join enjoy_price b on a.enjoy_id = b.enjoy_id
             where 1 =1
             <if test="enjoy_id != null and enjoy_id != ''">
               and a.enjoy_id 		= #{enjoy_id}
             </if>
             <if test="penjoy_id != null and penjoy_id != ''">  
               and a.penjoy_id		= #{penjoy_id}
             </if>
             <if test="enjoy_level != null and enjoy_level != ''">
               and a.enjoy_level	= #{enjoy_level}
             </if>
             <if test="use_yn != null and use_yn != ''">
               and a.use_yn		= #{use_yn}
             </if>
             <if test="enjoy_name != null and enjoy_name != ''">  
               and upper(a.enjoy_name)	like concat('%', #{enjoy_name}, '%')
             </if> 
             order by a.sort_flag
  </select>

  <insert id="insert_enjoy" parameterType="map">
            insert
              into enjoy_master (
                   penjoy_id
                 , enjoy_gubn
                 , price_yn
                 , enjoy_name
                 , enjoy_info
                 , location
                 , take_time
                 , transfer
				 , enjoy_exclude
                 , enjoy_include
                 , enjoy_prepare
                 , enjoy_detail
                 , enjoy_schedule
                 , kid_cond
                 , use_limit
                 , sort_flag
		         , init_date
		         , init_user
                 , up_date
                 , up_user
                 , use_yn
                 , est_yn
                 , main_yn
                 , company_code
                 , voucher_yn
            	 )
            values (
                   #{penjoy_id}
                 , #{enjoy_gubn}
                 , #{price_yn}
                 , #{enjoy_name}
                 , #{enjoy_info}
                 , #{location}
                 , #{take_time}
                 , #{transfer}
				 , #{enjoy_exclude}
                 , #{enjoy_include}
                 , #{enjoy_prepare}
                 , #{enjoy_detail}
                 , #{enjoy_schedule}
                 , #{kid_cond}
                 , #{use_limit}
                 , #{sort_flag}
                 , now()
                 , #{init_user}
                 , now()
                 , #{up_user}
                 , 'Y'
                 , #{est_yn}
                 , #{main_yn}
                 , #{company_code}
                 , #{voucher_yn}
                 )
  </insert>

  <update id="update_enjoy" parameterType="map">
            update enjoy_master
               set up_date			= now()
                 , up_user			= #{up_user}
         <if test="enjoy_gubn != null and enjoy_gubn != ''">                  
                 , enjoy_gubn		= #{enjoy_gubn}
         </if>
         <if test="penjoy_id != null and penjoy_id != ''">                  
                 , penjoy_id		= #{penjoy_id}		
         </if>
         <if test="enjoy_level != null and enjoy_level != ''">                  
                 , enjoy_level     = #{enjoy_level}		
         </if>
         <if test="price_yn != null and price_yn != ''">                  
                 , price_yn        = #{price_yn}       
         </if>
         <if test="enjoy_name != null and enjoy_name != ''">                   
                 , enjoy_name      = #{enjoy_name}     
         </if>
         <if test="enjoy_info != null and enjoy_info != ''">                   
                 , enjoy_info      = #{enjoy_info}     
         </if>
         <if test="location != null and location != ''">                   
                 , location        = #{location}        
         </if>
         <if test="take_time != null and take_time != ''">                  
                 , take_time       = #{take_time}       
         </if>
         <if test="transfer != null and transfer != ''">                  
                 , transfer        = #{transfer}       
         </if>
         <if test="enjoy_exclude != null and enjoy_exclude != ''">                   
				 , enjoy_exclude	= #{enjoy_exclude}	
         </if>
         <if test="enjoy_include != null and enjoy_include != ''"> 				 
                 , enjoy_include    = #{enjoy_include}  
         </if>
         <if test="enjoy_prepare != null and enjoy_prepare != ''">                    
                 , enjoy_prepare         = #{enjoy_prepare}
         </if>
         <if test="enjoy_detail != null and enjoy_detail != ''">                           
                 , enjoy_detail    = #{enjoy_detail}   
         </if>
         <if test="enjoy_schedule != null and enjoy_schedule != ''">                   
                 , enjoy_schedule = #{enjoy_schedule} 
         </if>
         <if test="kid_cond != null and kid_cond != ''">                  
                 , kid_cond        = #{kid_cond}       
         </if>
         <if test="use_limit != null and use_limit != ''">                   
                 , use_limit		= #{use_limit}		
         </if>
         <if test="sort_flag != null and sort_flag != ''">                  
                 , sort_flag       = #{sort_flag}      
         </if>
         <if test="use_yn != null and use_yn != ''">                   
                 , use_yn			= #{use_yn}		
         </if>
         <if test="company_code != null and company_code != ''">                  	
                 , company_code	= #{company_code}	
         </if>
         <if test="voucher_yn != null and voucher_yn != ''">                  
                 , voucher_yn		= ifnull(#{voucher_yn},'N')
         </if>
         <if test="est_yn != null and est_yn != ''">                  
                 , est_yn			= ifnull(#{est_yn},'N')
         </if>
         <if test="main_yn != null and main_yn != ''">                  
                 , main_yn			= ifnull(#{main_yn},'N')
         </if>
         <if test="img_path_00 != null and img_path_00 != ''">                  
                 , img_path_00		= #{img_path_00}	
         </if>
         <if test="img_path_01 != null and img_path_01 != ''">                  	
                 , img_path_01		= #{img_path_01}	
         </if>
         <if test="img_path_02 != null and img_path_02 != ''">                  	
                 , img_path_02		= #{img_path_02}	
         </if>
         <if test="img_path_03 != null and img_path_03 != ''">                  	
                 , img_path_03		= #{img_path_03}	
         </if>
         <if test="img_path_04 != null and img_path_04 != ''">                  	
                 , img_path_04		= #{img_path_04}	
         </if>
         <if test="img_path_05 != null and img_path_05 != ''">                  	
                 , img_path_05		= #{img_path_05}	
         </if>
         <if test="img_path_06 != null and img_path_06 != ''">                  	
                 , img_path_06		= #{img_path_06}	
         </if>
             where enjoy_id 		= #{enjoy_id}
  </update>

  <update id="update_enjoy_list" parameterType="map">
            update enjoy_master
               set up_date			= now()
                 , up_user			= #{up_user}
                 , sort_flag       = #{sort_flag}
             where enjoy_id 		= #{enjoy_id}
  </update>

  <delete id="delete_enjoy" parameterType="map">
            delete
              from enjoy_master
             where enjoy_id 		= #{enjoy_id}
  </delete>

  <select id="select_enjoy_price_list" parameterType="map" resultType="map">
            select a.enjoy_id
                 , a.enjoy_name
                 , a.sort_flag
                 , b.price_id
                 , b.price_name
                 , b.enjoy_desc
                 , b.adult_cost
                 , b.adult_sales_price
                 , b.adult_b2b_price
                 , b.kid_cost
                 , b.kid_sales_price
                 , b.kid_b2b_price
                 , c.code_name		as company_name
              from enjoy_master a left outer join code_master c on c.code = a.company_code and c.code_gubn = '111'
                 , enjoy_price b
             where a.enjoy_id		= b.enjoy_id
             <if test="enjoy_id != null and enjoy_id != ''">
               and a.enjoy_id 		= #{enjoy_id}
             </if>
             <if test="price_id != null and price_id != ''">  
               and b.price_id		= #{price_id}
             </if>
             <if test="est_yn != null and est_yn != ''">  
               and a.est_yn		= #{est_yn}
             </if>  
             order by a.enjoy_name
                    , b.price_id
  </select>

  <select id="select_enjoy_price_id" parameterType="map" resultType="map">
  			select ifnull(max(price_id)+1,1) as price_id from enjoy_price where enjoy_id = #{enjoy_id}
  </select>

  <insert id="insert_enjoy_price" parameterType="map">
            insert
              into enjoy_price (
                   enjoy_id
                 , price_id
                 , price_name
                 , enjoy_desc
                 , adult_cost
                 , adult_sales_price
                 , adult_b2b_price
                 , kid_cost
                 , kid_sales_price
                 , kid_b2b_price
                 , init_date
                 , init_user
                 , up_date
                 , up_user
            	 )
            values (
                   #{enjoy_id}
                 , #{price_id}
                 , #{price_name}
                 , #{enjoy_desc}
                 , case when #{adult_cost} = '' 			then 0 else #{adult_cost} end
                 , case when #{adult_sales_price} = '' 	then 0 else #{adult_sales_price} end
                 , case when #{adult_b2b_price} = '' 	then 0 else #{adult_b2b_price} end
                 , case when #{kid_cost} = '' 			then 0 else #{kid_cost} end
                 , case when #{kid_sales_price} = '' 	then 0 else #{kid_sales_price} end
                 , case when #{kid_b2b_price} = '' 		then 0 else #{kid_b2b_price} end
                 , now()
                 , #{init_user}
                 , now()
                 , #{up_user}
                 )
  </insert>

  <update id="update_enjoy_price" parameterType="map">
            update enjoy_price
               set up_date				= now()
                 , up_user				= #{up_user}
		<if test="price_name != null and price_name != ''">
                , price_name           = #{price_name}
        </if>
        <if test="enjoy_desc != null and enjoy_desc != ''">
                , enjoy_desc           = #{enjoy_desc}     
        </if>
        <if test="adult_cost != null and adult_cost != ''">                  
                , adult_cost           = #{adult_cost}     
        </if>
        <if test="adult_sales_price != null and adult_sales_price != ''">                  
                , adult_sales_price    = #{adult_sales_price}
        </if>
        <if test="adult_b2b_price != null and adult_b2b_price != ''">                
                , adult_b2b_price      = #{adult_b2b_price}
        </if>
        <if test="kid_cost != null and kid_cost != ''">                  
                , kid_cost             = #{kid_cost}       
        </if>
        <if test="kid_sales_price != null and kid_sales_price != ''">                  
                , kid_sales_price      = #{kid_sales_price}
        </if>
        <if test="kid_b2b_price != null and kid_b2b_price != ''">                  
                , kid_b2b_price        = #{kid_b2b_price}  
        </if>
             where enjoy_id 			= #{enjoy_id}
               and price_id				= #{price_id}
  </update>

  <delete id="delete_enjoy_price" parameterType="map">
            delete
              from enjoy_price
             where enjoy_id 			= #{enjoy_id}
               and price_id				= #{price_id}
  </delete>

  <delete id="delete_enjoy_price_all" parameterType="map">
            delete
              from enjoy_price
             where enjoy_id 			= #{enjoy_id}
  </delete>
  
  <update id="update_pic" parameterType="map">
 			update enjoy_master
               set enjoy_pic = #{enjoy_pic}
             where enjoy_id = #{enjoy_id} 
  </update>
  
</mapper>
