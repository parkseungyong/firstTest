<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="car">

	<select id="select_CarList" parameterType="map" resultType="map">
            select a.option_id
                 , a.option_nm_kr
                 , a.option_nm_eng
                 , a.corp_cd
                 , b.code_name as corp_nm
                 , a.category_cd
                 , c.code_name as category_nm
                 , a.min_sales_price
                 , a.sales_mark
                 , a.use_yn
                 , a.ordering
              from tb_join_option a
                 , tb_join_code b
                 , tb_join_code c
             where a.corp_cd 	 = b.code and b.code_gubn = '003'
               and a.category_cd = c.code and c.code_gubn = '105'
               and a.option_gubn = 'C'
             <if test="s_corp_cd != null and s_corp_cd != ''">
               and a.corp_cd		= #{s_corp_cd}
             </if>
             <if test="s_category_cd != null and s_category_cd != ''">
               and a.category_cd 		= #{s_category_cd}
             </if>
             <if test="s_use_yn != null and s_use_yn != ''">
               and a.use_yn		= #{s_use_yn}
             </if>
             <if test="s_option_nm_kr != null and s_option_nm_kr != ''">
               and (upper(a.s_option_nm_eng) like upper(concat('%', #{s_option_nm_kr}, '%')) or a.s_option_nm_kr like '%' #{s_option_nm_kr} '%')
             </if>           
             order by a.use_yn desc
                    , a.ordering
             		, c.sort_flag
                    , a.option_nm_eng
	</select>

	<insert id="insert_CarInfo" parameterType="map">
            insert
              into tb_join_option (
                   option_nm_kr
                 , option_nm_eng
                 , option_gubn
                 , division_cd
                 , corp_cd
                 , category_cd
                 , recommend_yn
                 , weekly_deal_yn
                 , use_yn
                 , summ_info1
                 , summ_info2
                 , sales_mark
                 , cancel_day
                 , min_sales_price
                 , sales_title1
                 , sales_title2
                 , promotion_info
                 , weekly_deal_info
				 , price_info
                 , caution_info1
                 , regist_datetime 
                 , regist_user
            ) values (
                   #{option_nm_kr}
                 , #{option_nm_eng}
                 , #{option_gubn}
                 , #{division_cd}
                 , #{corp_cd}
                 , #{category_cd}
                 , #{recommend_yn}
                 , #{weekly_deal_yn}
                 , #{use_yn}
				 , #{summ_info1}
                 , #{summ_info2}
                 , #{sales_mark}
                 , case #{cancel_day} when '' then 0 when (#{cancel_day} is NULL) then 0 else #{cancel_day} end
                 , case #{min_sales_price} when '' then 0 when (#{min_sales_price} is NULL) then 0 else #{min_sales_price} end
                 , #{sales_title1}
                 , #{sales_title2}
                 , #{promotion_info}
                 , #{weekly_deal_info}
				 , #{price_info}
                 , #{caution_info1}
                 , date_format(now(), '%Y%m%d%H%i%s')
                 , #{regist_user}
            )
        <selectKey resultType="int" keyProperty="option_id" order="AFTER">
			select last_insert_id()
		</selectKey>
	</insert>
	
	<update id="update_CarImage" parameterType="map">
			update tb_join_option
			   set main_picture = #{main_picture}
			 where option_id 	= #{option_id}
	</update>

	<update id="update_CarInfo" parameterType="map">
			update tb_join_option
			   set option_nm_kr     = #{option_nm_kr}
                 , option_nm_eng    = #{option_nm_eng}
                 , option_gubn      = #{option_gubn}
                 , division_cd      = #{division_cd}
                 , corp_cd          = #{corp_cd}
				 , category_cd      = #{category_cd}
                 , recommend_yn     = #{recommend_yn}
                 , weekly_deal_yn   = #{weekly_deal_yn}
                 , use_yn           = #{use_yn}
                 , summ_info1       = #{summ_info1}
                 , summ_info2       = #{summ_info2}
                 , sales_mark       = #{sales_mark}                 
                 , cancel_day       = case #{cancel_day} when '' then 0 when (#{cancel_day} is NULL) then 0 else #{cancel_day} end
                 , min_sales_price  = case #{min_sales_price} when '' then 0 else #{min_sales_price} end 
                 , sales_title1     = #{sales_title1}
                 , sales_title2     = #{sales_title2}
                 , promotion_info   = #{promotion_info}
                 , weekly_deal_info = #{weekly_deal_info}
                 , caution_info1    = #{caution_info1}
		         , main_picture     = #{main_picture}
		         , price_info       = #{price_info}
                 , change_datetime  = date_format(now(), '%Y%m%d%H%i%s')
                 , change_user      = #{change_user}
           where option_id 		    = #{option_id}
	</update>
	
	<update id="update_CarList" parameterType="map">
            update tb_join_option
               set change_datetime	= date_format(now(), '%Y%m%d%H%i%s')
                 , change_user		= #{change_user}
                 , ordering     	= #{ordering}
                 , use_yn           = #{use_yn}
             where option_id 		= #{option_id}
 	</update>
 	
 	<delete id="delete_CarInfo" parameterType="map">
            delete 
              from tb_join_option
             where option_id 		= #{option_id}
 	</delete>
 	
	<select id="select_CarInfo" parameterType="map" resultType="map">
            select a.option_id
                 , a.option_nm_kr
                 , a.option_nm_eng
                 , concat(a.option_nm_kr, ' (', a.option_id, ')') as option_title
                 , a.option_gubn
                 , a.division_cd
                 , a.corp_cd
                 , b.code_name as corp_nm
                 , a.category_cd
                 , c.code_name as category_nm
                 , a.recommend_yn
                 , a.weekly_deal_yn
                 , a.use_yn
                 , a.summ_info1
                 , a.summ_info2
                 , a.sales_mark
                 , a.cancel_day
                 , a.min_sales_price
                 , a.main_picture
                 , a.sales_title1
                 , a.sales_title2
                 , a.promotion_info
                 , a.weekly_deal_info
                 , a.caution_info1
                 , a.price_info
			  from tb_join_option a
                 , tb_join_code b
                 , tb_join_code c
             where a.corp_cd 	 = b.code and b.code_gubn = '003'
               and a.category_cd = c.code and c.code_gubn = '105'
               and a.option_id	= #{option_id}     
	</select>
	
	<insert id="insert_CarPromotionList" parameterType="map">
			insert into tb_join_optionpromotion (
						  option_id
						, promotion_nm_kr
						, promotion_nm_eng
						, book_cd
						, min_day
						, include
						, remarks
						, use_yn
						, ordering
						, regist_datetime 
                 		, regist_user
					) values (
						  #{option_id}
						, #{promotion_nm_kr}
						, #{promotion_nm_eng}
						, #{book_cd}
						, case #{min_day} when '' then 0 when (#{min_day} is NULL) then 0 else #{min_day} end
						, #{include}
						, #{remarks}
						, #{use_yn}
						, case #{ordering} when '' then 0 when (#{ordering} is NULL) then 0 else #{ordering} end
						, date_format(now(), '%Y%m%d%H%i%s')
                 		, #{regist_user}				
					)
	</insert>
	
	<update id="update_CarPromotionList" parameterType="map">
			update tb_join_optionpromotion
				set promotion_nm_kr  = #{promotion_nm_kr}
				  , promotion_nm_eng = #{promotion_nm_eng}
				  , book_cd          = #{book_cd}
				  , min_day          = case #{min_day} when '' then 0 when (#{min_day} is NULL) then 0 else #{min_day} end
				  , include          = #{include}
				  , remarks          = #{remarks}
				  , use_yn           = #{use_yn}
				  , ordering         = case #{ordering} when '' then 0 when (#{ordering} is NULL) then 0 else #{ordering} end
                  , change_datetime  = date_format(now(), '%Y%m%d%H%i%s')
                  , change_user      = #{change_user}
			 where promotion_id = #{promotion_id}
			   and option_id    = #{option_id}
	</update>
	
	<delete id="delete_CarPromotionList" parameterType="map">
			delete 
              from tb_join_optionpromotion
             where promotion_id = #{promotion_id}
               and option_id 	= #{option_id}
	</delete>
	
	<select id="select_CarPromotionList" parameterType="map" resultType="map">
			select promotion_id
				 , option_id
				 , promotion_nm_kr
				 , promotion_nm_eng
				 , book_cd
				 , min_day
				 , include
				 , remarks
				 , use_yn
				 , ordering
			  from tb_join_optionpromotion
			 where option_id = #{option_id}
	</select>
	
	<insert id="insert_CarPriceList" parameterType="map">
			insert into tb_join_carprice (
					  option_id
					, promotion_id
					, start_date
					, end_date
					, day_price
					, weekly_price
					, extra_price
					, sales_start_date
					, sales_end_date
					, use_yn
					, regist_datetime 
                 	, regist_user
                 ) values (
                 	  option_id
					, promotion_id
					, start_date
					, end_date
					, case #{day_price} when '' then 0 when (#{day_price} is NULL) then 0 else #{day_price} end
					, case #{weekly_price} when '' then 0 when (#{weekly_price} is NULL) then 0 else #{weekly_price} end
					, case #{extra_price} when '' then 0 when (#{extra_price} is NULL) then 0 else #{extra_price} end
					, #{sales_start_date}
					, #{sales_end_date}
					, #{use_yn}
					, date_format(now(), '%Y%m%d%H%i%s')
                 	, #{regist_user}
                 )
	</insert>
	
	<update id="update_CarPriceList" parameterType="map">
			update tb_join_carprice
				set promotion_id     = #{promotion_id}
				  , start_date       = #{start_date}
				  , end_date         = #{end_date}
				  , day_price        = case #{day_price} when '' then 0 when (#{day_price} is NULL) then 0 else #{day_price} end
				  , weekly_price     = case #{weekly_price} when '' then 0 when (#{weekly_price} is NULL) then 0 else #{weekly_price} end
				  , extra_price      = case #{extra_price} when '' then 0 when (#{extra_price} is NULL) then 0 else #{extra_price} end
				  , sales_start_date = #{sales_start_date}
				  , sales_end_date   = #{sales_end_date}
				  , use_yn           = #{use_yn}
				  , change_datetime  = date_format(now(), '%Y%m%d%H%i%s')
                  , change_user      = #{change_user}
			 where price_id  = #{price_id}
			   and option_id = #{option_id}
	</update>
	
	<delete id="delete_CarPriceList" parameterType="map">
			delete 
			  from tb_join_carprice
			 where price_id  = #{price_id}
			   and option_id = #{option_id}
	</delete>
	
	<select id="select_CarPriceList" parameterType="map" resultType="map">
			select price_id
				 , option_id
				 , promotion_id
				 , start_date
				 , end_date
				 , day_price
				 , weekly_price
				 , extra_price
				 , sales_start_date
				 , sales_end_date
				 , use_yn
			  from tb_join_carprice
			 where option_id = #{option_id}
	</select>
</mapper>
