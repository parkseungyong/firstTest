<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="option">

	<select id="select_OptionList" parameterType="map" resultType="map">
            select a.option_id
                 , a.option_nm_kr
                 , a.option_nm_eng
                 , a.corp_cd
                 , b.code_name as corp_nm
                 , a.category_cd
                 , c.code_name as category_nm
                 , a.min_sales_price
                 , a.sales_mark
                 , a.recommend_yn
                 , a.weekly_deal_yn
                 , a.use_yn
                 , a.ordering
              from tb_join_option a
                 , tb_join_code b
                 , tb_join_code c
             where a.corp_cd 	 = b.code and b.code_gubn = '003'
               and a.category_cd = c.code and c.code_gubn = '102'
               and a.option_gubn = 'S'
             <if test="s_corp_cd != null and s_corp_cd != ''">
               and a.corp_cd		= #{s_corp_cd}
             </if>
             <if test="s_category_cd != null and s_category_cd != ''">
               and a.category_cd 		= #{s_category_cd}
             </if>
             <if test="s_use_yn != null and s_use_yn != ''">
               and a.use_yn		= #{s_use_yn}
             </if>
             <if test="s_option_nm_kr != null and s_option_nm_kr != ''">
               and (upper(a.s_option_nm_eng) like upper(concat('%', #{s_option_nm_kr}, '%')) or a.s_option_nm_kr like '%' #{s_option_nm_kr} '%')
             </if>
             <if test="s_recommend_yn != null and s_recommend_yn != ''">
               and a.recommend_yn		= #{s_recommend_yn}
             </if>
             <if test="s_weekly_deal_yn != null and s_weekly_deal_yn != ''">
               and a.weekly_deal_yn		= #{s_weekly_deal_yn}
             </if>             
             order by a.use_yn desc
                    , a.ordering
             		, c.sort_flag
                    , a.option_nm_eng
	</select>

	<insert id="insert_OptionInfo" parameterType="map">
            insert
              into tb_join_option (
                   option_nm_kr
                 , option_nm_eng
                 , option_gubn
                 , division_cd
                 , corp_cd
                 , category_cd
                 , recommend_yn
                 , weekly_deal_yn
                 , use_yn
                 , summ_info1
                 , summ_info2
                 , sales_mark
                 , cancel_day
                 , language
                 , min_sales_price
                 , display_type
                 , sales_title1
                 , sales_title2
                 , promotion_info
                 , weekly_deal_info
                 , default_info
                 , caution_info1
                 , caution_info2
                 , keyword
                 , regist_datetime 
                 , regist_user
            ) values (
                   #{option_nm_kr}
                 , #{option_nm_eng}
                 , #{option_gubn}
                 , #{division_cd}
                 , #{corp_cd}
                 , #{category_cd}
                 , #{recommend_yn}
                 , #{weekly_deal_yn}
                 , #{use_yn}
				 , #{summ_info1}
                 , #{summ_info2}
                 , #{sales_mark}
                 , case #{cancel_day} when '' then 0 when (#{cancel_day} is NULL) then 0 else #{cancel_day} end
                 , #{language}
                 , case #{min_sales_price} when '' then 0 when (#{min_sales_price} is NULL) then 0 else #{min_sales_price} end
                 , #{display_type}
                 , #{sales_title1}
                 , #{sales_title2}
                 , #{promotion_info}
                 , #{weekly_deal_info}
                 , #{default_info}
                 , #{caution_info1}
                 , #{caution_info2}
                 , #{keyword}
                 , date_format(now(), '%Y%m%d%H%i%s')
                 , #{regist_user}
            )
        <selectKey resultType="int" keyProperty="option_id" order="AFTER">
			select last_insert_id()
		</selectKey>
	</insert>
	
	<update id="update_OptionImage" parameterType="map">
			update tb_join_option
			   set main_picture = #{main_picture}
			 where option_id 	= #{option_id}
	</update>

	<update id="update_OptionInfo" parameterType="map">
			update tb_join_option
			   set option_nm_kr     = #{option_nm_kr}
                 , option_nm_eng    = #{option_nm_eng}
                 , option_gubn      = #{option_gubn}
                 , division_cd      = #{division_cd}
                 , corp_cd          = #{corp_cd}
				 , category_cd      = #{category_cd}
                 , recommend_yn     = #{recommend_yn}
                 , weekly_deal_yn   = #{weekly_deal_yn}
                 , use_yn           = #{use_yn}
                 , summ_info1       = #{summ_info1}
                 , summ_info2       = #{summ_info2}
                 , sales_mark       = #{sales_mark}                 
                 , cancel_day       = case #{cancel_day} when '' then 0 when (#{cancel_day} is NULL) then 0 else #{cancel_day} end
                 , language         = #{language}
                 , min_sales_price  = case #{min_sales_price} when '' then 0 else #{min_sales_price} end 
                 , sales_title1     = #{sales_title1}
                 , sales_title2     = #{sales_title2}
                 , promotion_info   = #{promotion_info}
                 , weekly_deal_info = #{weekly_deal_info}
                 , default_info     = #{default_info}
                 , caution_info1    = #{caution_info1}
                 , caution_info2    = #{caution_info2}
		         , main_picture     = #{main_picture}
                 , keyword          = #{keyword}
                 , change_datetime  = date_format(now(), '%Y%m%d%H%i%s')
                 , change_user      = #{change_user}
           where option_id 		    = #{option_id}
	</update>
	
	<update id="update_OptionList" parameterType="map">
            update tb_join_option
               set change_datetime	= date_format(now(), '%Y%m%d%H%i%s')
                 , change_user		= #{change_user}
                 , ordering     	= #{ordering}
                 , recommend_yn     = #{recommend_yn}
                 , weekly_deal_yn   = #{weekly_deal_yn}
                 , use_yn           = #{use_yn}
             where option_id 		= #{option_id}
 	</update>
 	
 	<delete id="delete_OptionInfo" parameterType="map">
            delete 
              from tb_join_option
             where option_id 		= #{option_id}
 	</delete>
 	
	<select id="select_OptionInfo" parameterType="map" resultType="map">
            select a.option_id
                 , a.option_nm_kr
                 , a.option_nm_eng
                 , concat(a.option_nm_kr, ' (', a.option_id, ')') as option_title
                 , a.option_gubn
                 , a.division_cd
                 , a.corp_cd
                 , b.code_name as corp_nm
                 , a.category_cd
                 , c.code_name as category_nm
                 , a.recommend_yn
                 , a.weekly_deal_yn
                 , a.use_yn
                 , a.summ_info1
                 , a.summ_info2
                 , a.sales_mark
                 , a.cancel_day
                 , a.language
                 , a.min_sales_price
                 , a.main_picture
                 , a.display_type
                 , a.sales_title1
                 , a.sales_title2
                 , a.promotion_info
                 , a.weekly_deal_info
                 , a.default_info
                 , a.caution_info1
                 , a.caution_info2
                 , a.keyword
			  from tb_join_option a
                 , tb_join_code b
                 , tb_join_code c
             where a.corp_cd 	 = b.code and b.code_gubn = '003'
               and a.category_cd = c.code and c.code_gubn = '102'
               and a.option_id	= #{option_id}     
	</select>
	
	<insert id="insert_OptionProduct" parameterType="map">
		insert into tb_join_product(
				  option_id
				, product_nm_kr
				, product_nm_eng
				, product_group_nm
				, product_gubn
				, reserve_time
				, product_info
				, adult_cost
				, adult_price
				, child_yn
				, child_start_age
				, child_end_age
				, child_cost
				, child_price
				, baby_yn
				, pickup_yn
				, min_count
				, height_yn
				, schedule
				, add_select1
				, add_select2
				, add_select3
				, add_desc
				, location
				, trans_info
				, cancel_info
				, offday_info
				, guide_info
				, laptime
				, prepare_info
				, caution_info
				, include
				, exclude
				, holiday
				, address
				, use_yn
				, regist_datetime 
                , regist_user				
			) values (
				  #{option_id}
				, #{product_nm_kr}
				, #{product_nm_eng}
				, #{product_group_nm}
				, #{product_gubn}
				, #{reserve_time}
				, #{product_info}
				, case #{adult_cost} when '' then 0 when (#{adult_cost} is NULL) then 0 else #{adult_cost} end
				, case #{adult_price} when '' then 0 when (#{adult_price} is NULL) then 0 else #{adult_price} end
				, #{child_yn}
				, case #{child_start_age} when '' then 0 when (#{child_start_age} is NULL) then 0 else #{child_start_age} end
				, case #{child_end_age} when '' then 0 when (#{child_end_age} is NULL) then 0 else #{child_end_age} end
				, case #{child_cost} when '' then 0 when (#{child_cost} is NULL) then 0 else #{child_cost} end
				, case #{child_price} when '' then 0 when (#{child_price} is NULL) then 0 else #{child_price} end
				, #{baby_yn}
				, #{pickup_yn}
				, case #{min_count} when '' then 0 when (#{min_count} is NULL) then 0 else #{min_count} end
				, #{height_yn}
				, #{schedule}
				, #{add_select1}
				, #{add_select2}
				, #{add_select3}
				, #{add_desc}
				, #{location}
				, #{trans_info}
				, #{cancel_info}
				, #{offday_info}
				, #{guide_info}
				, #{laptime}
				, #{prepare_info}
				, #{prepare_info}
				, #{include}
				, #{exclude}
				, #{holiday}
				, #{address}
				, #{use_yn}
				, date_format(now(), '%Y%m%d%H%i%s')
                , #{regist_user}		
			)
        <selectKey resultType="int" keyProperty="product_id" order="AFTER">
			select last_insert_id()
		</selectKey>			
	</insert>
	
	<update id="update_OptionProduct" parameterType="map">
		update tb_join_product
			  set option_id        = #{option_id}
				, product_nm_kr    = #{product_nm_kr}
				, product_nm_eng   = #{product_group_nm}
				, product_group_nm = #{product_group_nm}
				, product_gubn     = #{product_gubn}
				, reserve_time     = #{reserve_time}
				, product_info     = #{product_info}
				, adult_cost       = case #{adult_cost} when '' then 0 when (#{adult_cost} is NULL) then 0 else #{adult_cost} end
				, adult_price      = case #{adult_price} when '' then 0 when (#{adult_price} is NULL) then 0 else #{adult_price} end
				, child_yn         = #{child_yn}
				, child_start_age  = case #{child_start_age} when '' then 0 when (#{child_start_age} is NULL) then 0 else #{child_start_age} end
				, child_end_age    = case #{child_end_age} when '' then 0 when (#{child_end_age} is NULL) then 0 else #{child_end_age} end
				, child_cost       = case #{child_cost} when '' then 0 when (#{child_cost} is NULL) then 0 else #{child_cost} end
				, child_price      = case #{child_price} when '' then 0 when (#{child_price} is NULL) then 0 else #{child_price} end
				, baby_yn          = #{baby_yn}
				, pickup_yn        = #{pickup_yn}
				, min_count        = case #{min_count} when '' then 0 when (#{min_count} is NULL) then 0 else #{min_count} end
				, height_yn        = #{height_yn}
				, schedule         = #{schedule}
				, add_select1      = #{add_select1}
				, add_select2      = #{add_select2}
				, add_select3      = #{add_select3}
				, add_desc         = #{add_desc}
				, location         = #{location}
				, trans_info       = #{trans_info}
				, cancel_info      = #{cancel_info}
				, offday_info      = #{offday_info}
				, guide_info       = #{guide_info}
				, laptime          = #{laptime}
				, prepare_info     = #{prepare_info}
				, caution_info     = #{prepare_info}
				, include          = #{include}
				, exclude          = #{exclude}
				, holiday          = #{holiday}
				, address          = #{address}
				, address_url      = #{address_url}
				, use_yn           = #{use_yn}
				, change_datetime  = date_format(now(), '%Y%m%d%H%i%s')
                , change_user      = #{change_user}				
		where product_id = #{product_id}
	</update>

	<update id="update_OptionProductImage" parameterType="map">
		update tb_join_product
		   set address_url = #{address_url}
		 where product_id= #{product_id}
	</update>
	
	<update id="update_OptionProductList" parameterType="map">
		update tb_join_product
		   set product_nm_kr    = #{product_nm_kr}
		     , product_group_nm = #{product_group_nm}
		     , reserve_time     = #{reserve_time}
			 , adult_cost       = case #{adult_cost} when '' then 0 when (#{adult_cost} is NULL) then 0 else #{adult_cost} end
			 , adult_price      = case #{adult_price} when '' then 0 when (#{adult_price} is NULL) then 0 else #{adult_price} end
			 , child_cost       = case #{child_cost} when '' then 0 when (#{child_cost} is NULL) then 0 else #{child_cost} end
			 , child_price      = case #{child_price} when '' then 0 when (#{child_price} is NULL) then 0 else #{child_price} end
		     , pickup_yn        = #{pickup_yn}
		     , min_count        = case #{min_count} when '' then 0 when (#{min_count} is NULL) then 0 else #{min_count} end
		     , use_yn           = #{use_yn}
			 , ordering         = case #{ordering} when '' then 0 when (#{ordering} is NULL) then 0 else #{ordering} end
			 , change_datetime  = date_format(now(), '%Y%m%d%H%i%s')
             , change_user      = #{change_user}			 
		 where product_id = #{product_id} 
	</update>
	
	<delete id="delete_OptionProduct" parameterType="map">
		delete 
		  from tb_join_product
		 where product_id = #{product_id}
	</delete>

	<select id="select_OptionProductList" parameterType="map" resultType="map">
		select product_id
		     , option_id
		     , product_nm_kr
		     , product_group_nm
		     , reserve_time
			 , adult_cost
			 , adult_price
			 , child_cost
			 , child_price
		     , pickup_yn
		     , min_count
		     , holiday
		     , use_yn
			 , ordering
		 from tb_join_product
		where option_id = #{option_id}
		order by ordering
	</select>
	
	<select id="select_OptionProductInfo" parameterType="map" resultType="map">
		select option_id
				, product_id
				, product_nm_kr
				, product_nm_eng
				, product_group_nm
				, product_gubn
				, reserve_time
				, product_info
				, adult_cost
				, adult_price
				, child_yn
				, child_start_age
				, child_end_age
				, child_cost
				, child_price
				, baby_yn
				, pickup_yn
				, min_count
				, height_yn
				, schedule
				, add_select1
				, add_select2
				, add_select3
				, add_desc
				, location
				, trans_info
				, cancel_info
				, offday_info
				, guide_info
				, laptime
				, prepare_info
				, caution_info
				, include
				, exclude
				, holiday
				, address
				, address_url
				, use_yn
		 from tb_join_product
		where product_id = #{product_id}
	</select>

	<insert id="copy_OptionProductInfo" parameterType="map">
		insert into tb_join_product(
				  option_id
				, product_nm_kr
				, product_nm_eng
				, product_group_nm
				, product_gubn
				, reserve_time
				, product_info
				, adult_cost
				, adult_price
				, child_yn
				, child_start_age
				, child_end_age
				, child_cost
				, child_price
				, baby_yn
				, pickup_yn
				, min_count
				, height_yn
				, schedule
				, add_select1
				, add_select2
				, add_select3
				, add_desc
				, location
				, trans_info
				, cancel_info
				, offday_info
				, guide_info
				, laptime
				, prepare_info
				, caution_info
				, include
				, exclude
				, holiday
				, address
				, use_yn
				, regist_datetime 
                , regist_user				
			) select 
				  option_id
				, product_nm_kr
				, product_nm_eng
				, product_group_nm
				, product_gubn
				, reserve_time
				, product_info
				, adult_cost
				, adult_price
				, child_yn
				, child_start_age
				, child_end_age
				, child_cost
				, child_price
				, baby_yn
				, pickup_yn
				, min_count
				, height_yn
				, schedule
				, add_select1
				, add_select2
				, add_select3
				, add_desc
				, location
				, trans_info
				, cancel_info
				, offday_info
				, guide_info
				, laptime
				, prepare_info
				, caution_info
				, include
				, exclude
				, holiday
				, address
				, use_yn
				, date_format(now(), '%Y%m%d%H%i%s')
                , #{regist_user}				
			 from tb_join_product
			where product_id = #{product_id}	
	</insert>
	
	<insert id="insert_OptionBlackoutList" parameterType="map">
		insert 
			into tb_join_optionblackout (
				  product_id
				, option_id
				, start_date
				, end_date
				, remarks
				, use_yn
				, regist_datetime 
                , regist_user
			) values (
				  #{product_id}
				, #{option_id}
				, #{start_date}
				, #{end_date}
				, #{remarks}
				, #{use_yn}
				, date_format(now(), '%Y%m%d%H%i%s')
                , #{regist_user}
			)
	</insert>
	
	<update id="update_OptionBlackoutList" parameterType="map">
		update tb_join_optionblackout
			set product_id      = #{product_id}
			  , start_date      = #{start_date}
			  , end_date        = #{end_date}
			  , remarks         = #{remarks}
			  , use_yn          = #{use_yn}
			  , change_datetime = date_format(now(), '%Y%m%d%H%i%s')
              , change_user     = #{change_user}
         where blackout_id = #{blackout_id}
           and option_id = #{option_id}
	</update>
	
	<delete id="delete_OptionBlackoutList" parameterType="map">
			delete
			  from tb_join_optionblackout
			 where blackout_id = #{blackout_id}
               and option_id = #{option_id}
	</delete>
	
	<select id="select_OptionBlackoutList" parameterType="map" resultType="map">
			select blackout_id
				, product_id
				, option_id
				, start_date
				, end_date
				, remarks
				, use_yn
			  from tb_join_optionblackout
			 where option_id = #{option_id} 
		<if test="s_product_id != null and s_product_id != ''">
			   and product_id = #{s_product_id}
		</if>
		<if test="s_start_date != null and s_start_date != ''">
			<![CDATA[ and start_date >= #{s_start_date} ]]>
		</if>
		<if test="s_end_date != null and s_end_date != ''">
  			<![CDATA[ and end_date <= #{s_end_date} ]]>
  		</if>
	</select>
</mapper>
